<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broadcast Station Monitor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <h1>üìª Broadcast Station Monitor</h1>
            <p class="nav-subtitle">Shortwave Radio Monitoring with Live Audio</p>
        </div>
        <div class="nav-stats">
            <div class="stat-item">
                <span class="stat-label">Time (UTC)</span>
                <span class="stat-value" id="utc-time">--:--:--</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total Stations</span>
                <span class="stat-value" id="total-count">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">On Air Now</span>
                <span class="stat-value" id="active-count">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Listening</span>
                <span class="stat-value" id="listening-count">0</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('time')">üìÖ By Time Schedule</button>
            <button class="tab-btn" onclick="switchTab('frequency')">üì° By Frequency</button>
        </div>

        <div class="controls">
            <div class="view-toggle">
                <button class="toggle-btn active" onclick="switchDisplay('table')" id="toggle-table">üìä Table View</button>
                <button class="toggle-btn" onclick="switchDisplay('cards')" id="toggle-cards">üìá Card View</button>
            </div>
            <div class="search-group">
                <input type="text" id="search" placeholder="Search by station, frequency, language...">
            </div>
            <button class="btn-reload" onclick="reloadSchedules()">üîÑ Reload</button>
        </div>

        <div class="frequency-bands">
            <h3>Quick Filter by Band</h3>
            <div class="band-filters">
                <button class="band-btn" onclick="filterByBand(null)">All Bands</button>
                <button class="band-btn" onclick="filterByBand(5, 6)">49m (5900-6200 kHz)</button>
                <button class="band-btn" onclick="filterByBand(7, 7.5)">41m (7100-7600 kHz)</button>
                <button class="band-btn" onclick="filterByBand(9, 10)">31m (9400-9900 kHz)</button>
                <button class="band-btn" onclick="filterByBand(11, 12)">25m (11600-12100 kHz)</button>
                <button class="band-btn" onclick="filterByBand(15, 16)">19m (15100-15800 kHz)</button>
                <button class="band-btn" onclick="filterByBand(17, 18)">16m (17480-17900 kHz)</button>
            </div>
        </div>

        <div id="stations-container" class="stations-table">
            <div class="loading">Loading stations...</div>
        </div>
    </div>

    <div id="audio-status" class="audio-status">
        <div class="audio-status-content">
            <span id="audio-status-text">No audio playing</span>
            <button id="stop-all-audio" onclick="stopAllAudio()" style="display: none;">Stop All</button>
        </div>
    </div>

    <!-- Tuning Panel -->
    <div id="tuning-panel" class="tuning-panel" style="display: none;">
        <div class="tuning-header">
            <h3>üéõÔ∏è Tuning Controls</h3>
            <span id="tuning-station-info" class="tuning-station-info"></span>
            <button class="tuning-close" onclick="closeTuningPanel()">√ó</button>
        </div>
        
        <div class="tuning-content">
            <!-- AGC Controls -->
            <div class="tuning-section">
                <h4>AGC (Automatic Gain Control)</h4>
                <div class="tuning-control">
                    <label>
                        <input type="checkbox" id="agc-enable" onchange="updateAGC()">
                        Enable AGC
                    </label>
                </div>
                <div class="tuning-control" id="agc-params" style="display: none;">
                    <label>
                        Hangtime (seconds):
                        <input type="range" id="agc-hangtime" min="0" max="5" step="0.1" value="1.0" oninput="updateAGCValue('hangtime', this.value)">
                        <span id="agc-hangtime-value">1.0</span>
                    </label>
                </div>
                <div class="tuning-control" id="agc-headroom-ctrl" style="display: none;">
                    <label>
                        Headroom (dB):
                        <input type="range" id="agc-headroom" min="0" max="20" step="1" value="10" oninput="updateAGCValue('headroom', this.value)">
                        <span id="agc-headroom-value">10</span>
                    </label>
                </div>
            </div>

            <!-- Manual Gain Control -->
            <div class="tuning-section" id="manual-gain-section">
                <h4>Manual Gain</h4>
                <div class="tuning-control">
                    <label>
                        Gain (dB):
                        <input type="range" id="manual-gain" min="-20" max="40" step="1" value="0" oninput="updateGain(this.value)">
                        <span id="manual-gain-value">0</span>
                    </label>
                </div>
            </div>

            <!-- Filter Controls -->
            <div class="tuning-section">
                <h4>Filter</h4>
                <div class="tuning-control">
                    <label>
                        Low Edge (Hz):
                        <input type="number" id="filter-low" value="-5000" step="100" onchange="updateFilter()">
                    </label>
                </div>
                <div class="tuning-control">
                    <label>
                        High Edge (Hz):
                        <input type="number" id="filter-high" value="5000" step="100" onchange="updateFilter()">
                    </label>
                </div>
            </div>

            <!-- Main Frequency -->
            <div class="tuning-section">
                <h4>Frequency</h4>
                <div class="tuning-control">
                    <label>
                        Frequency (kHz):
                        <input type="number" id="main-freq" value="0" step="5" onchange="updateFrequency(this.value)">
                    </label>
                    <small>Change the main tuning frequency</small>
                </div>
            </div>

            <!-- Shift Frequency -->
            <div class="tuning-section">
                <h4>Fine Tuning (Shift)</h4>
                <div class="tuning-control">
                    <label>
                        Shift (Hz):
                        <input type="number" id="shift-freq" value="0" step="10" onchange="updateShift(this.value)">
                    </label>
                    <small>Fine-tune frequency (useful for CW/SSB)</small>
                </div>
            </div>

            <!-- Output Level -->
            <div class="tuning-section">
                <h4>Output Level</h4>
                <div class="tuning-control">
                    <label>
                        Volume:
                        <input type="range" id="output-level" min="0" max="1" step="0.05" value="0.5" oninput="updateOutputLevel(this.value)">
                        <span id="output-level-value">0.50</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Opus decoding done server-side, browser receives raw PCM -->
    <script src="app.js"></script>
</body>
</html>
